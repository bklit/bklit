---
title: Real-Time Setup
description: Enable real-time analytics for your self-hosted Bklit instance
---

# Real-Time Setup (Self-Hosted)

This guide shows you how to enable real-time analytics on your self-hosted Bklit instance. If you don't set this up, Bklit works perfectly fine with polling mode.

## Architecture Overview

Bklit uses **Server-Sent Events (SSE)** for real-time updates. This is simpler than WebSockets and doesn't require a separate server:

1. **Ingestion Service** → Receives events from SDK
2. **Redis Queue** → Buffers events for processing
3. **Worker** → Processes events, saves to ClickHouse, publishes to Redis Pub/Sub
4. **Dashboard API** → SSE endpoint subscribes to Redis Pub/Sub
5. **Browser** → Native `EventSource` receives real-time updates

**No separate WebSocket server needed!** Real-time is built into the Next.js dashboard.

## Prerequisites

- A server with Ubuntu/Debian (we use Hetzner in this example)
- Your Bklit dashboard already deployed
- Redis installed (see below)

## Step 1: Install Redis

SSH into your server and run:

```bash
apt update && apt install redis-server -y
```

Generate a strong password:

```bash
openssl rand -base64 32
```

Copy that password, then configure Redis:

```bash
cat > /etc/redis/redis.conf << 'EOF'
bind 127.0.0.1 ::1
port 6379
requirepass YOUR_PASSWORD_HERE
maxmemory 2gb
maxmemory-policy allkeys-lru
dir /var/lib/redis
EOF

systemctl restart redis-server
systemctl enable redis-server
```

Test it works:

```bash
redis-cli -a 'YOUR_PASSWORD' ping
# Should return: PONG
```

## Step 2: Configure Environment Variables

Add these environment variables to your dashboard deployment:

```bash
REDIS_URL=redis://:YOUR_PASSWORD@YOUR_SERVER:6379
```

For **Vercel**: Add this in Project Settings → Environment Variables

For **self-hosted**: Add to your `.env` file or systemd service

## Step 3: Deploy

Push your code and the real-time features will activate automatically!

The dashboard includes two SSE endpoints:
- `/api/live-stream` - Real-time analytics events (pageviews, custom events, session ends)
- `/api/debug-stream` - Pipeline monitoring (for the terminal view)

## Verify It's Working

Check the health endpoint:

```bash
curl https://your-domain.com/api/health/realtime
```

Should return:
```json
{"status":"healthy","redis":"connected","mode":"realtime"}
```

Open your dashboard and you should see:
- Green indicator dot next to live user count
- Instant toast notifications when visitors arrive
- Map markers appear in real-time
- Session details update live

## How It Works

When a visitor triggers an event:

1. SDK sends event to ingestion service
2. Event is queued in Redis
3. Worker processes event, saves to ClickHouse
4. Worker publishes to `live-events` Redis channel
5. Dashboard's `/api/live-stream` SSE endpoint receives the event
6. Browser's `EventSource` gets the update instantly
7. React components update via the `useLiveEventStream` hook

## Troubleshooting

**Not seeing real-time updates:**
- Check Redis is running: `systemctl status redis-server`
- Verify `REDIS_URL` environment variable is set correctly
- Check browser console for SSE connection errors

**Redis connection errors:**
- Check Redis password is correct
- Verify Redis is accessible from your dashboard server
- If using Vercel, ensure Redis is accessible from the internet (or use a managed Redis like Upstash)

**Falling back to polling:**
- This is normal if Redis is unavailable
- Analytics still work, just not real-time
- The dashboard polls every 10 seconds as fallback

## Local Development

For local development, Redis runs in Docker via `docker-compose.yml`:

```bash
pnpm dev:services  # Starts Redis, ClickHouse, ingestion, worker
pnpm dev           # Starts dashboard
```

Real-time works automatically in local development!

That's it! Real-time analytics is now built into your dashboard with no extra servers needed.
